## 比特币对接


### 地址分类
- p2sk(``)   
- p2skh(主网地址是以"1"开头,例如:`16dN3XhaTejyZFy4hWompK2x8de2T46wA8`; 测试网是以"m"或"n"开头, 例如:`mvZjn2485hwxjVPJoLAZVyJKUDn8aGpBy5`)
- p2sh (主网地址是以"3"开头,例如:`33ZzFZZJcvtnLBWRdne6F9SpD9Rc7sjSDX`; 测试网以"2"开头,例如:`2Mt5wo9k8ykrJLrszhom1drPLNSArYAbLsH`;  ), 目前, 多重签名基本上使用这种类型地址


## 对接流程

### 1.地址导入

- 热钱包(私钥在钱包软件中):通过钱包密码就可以直接进行转账

- 观察钱包(私钥不在钱包软件中):只能监测地址的入币和出币,可以通过listunspent列出其utxo集, 也可以使用createrawtransaction创建交易



### 2.列出utxo
通过rpc接口`listunspent`列出一个地址的utxo集



```
listunspent  最小确认数  最大确认数  ["地址1", "地址2" ]  include_unsafe(是否包含不安全的utxo,即确认数太少)  query_options("其他查询选项")

例如:

listunspent 0 9999999 '[\'2MyeRq1tEWJR9rNeTcAZzoW6tUZiQpvRJum\']' true  

```

![](./img/listunspent.png)







### 3.创建裸交易

```
createrawtransaction "[{\"txid\":\"1f945d93db219da806538eacb9251856687c40b5879941ddd01692734c8c229d\", \"vout\":\"1\"}]" "{\"mv4rnyY3Su5gjcDNzbMLKBQkBicCtHUtFB\":\"0.0001\",\"2Mt5wo9k8ykrJLrszhom1drPLNSArYAbLsH\":\"0.028000\"}"

```

![](./img/创建交易.png)





### 4.交易签名(离线, 在线)


- 离线签名(支持多签, 如果是p2sh地址, 需要填写redeemScript, redeemScript创建多签地址时生成的, 如果是普通p2sh地址需要将私钥导入钱包,使用listunspent可以查看到redeemScript)
```
signrawtransactionwithkey 02000000019d228c4c739216d0dd419987b5407c68561825b9ac8e5306a89d21db935d941f0100000000ffffffff0210270000000000001976a9149f9a7abd600c0caa03983a77c8c3df8e062cb2fa88ac80b92a000000000017a9140936dda3ae8df6ae9c8f3f48948caaad60cc44d18700000000 "[\"cPGsdAQLFnKRWrtbGKbdcbLRCnx2MEJ7vk5uCFy9a6PRpNaJDsAT\"]" "[{\"txid\":\"1f945d93db219da806538eacb9251856687c40b5879941ddd01692734c8c229d\", \"vout\":1, \"redeemScript\": \"0014db469d3cddb96c5fb6a6b5bebb9bc97ef71cc0e0\", \"scriptPubKey\": \"a9140936dda3ae8df6ae9c8f3f48948caaad60cc44d187\",\"amount\": 0.13850667}]" "ALL"

```

- 在线签名(私钥在钱包中)不需要inputs


- 普通p2skh地址(主网是"1"开头, 测试网是"m"或"n"开头), input中不需要填写 redeemScript

![](./img/交易签名.png)



### 5.发送交易

在全节点上使用sendrawtransaction发送即可




## 区块监测

- 方案1(理论上适用所有币)

  解析最新区块中的交易, 找到关心的交易

- 方案2(比特币可以用这种方法做, 其他币未知)

  将地址导入钱包中(观察钱包), 使用 `listunspent`(可以设置确认数)来监测区块变化, 例如:使用`listunspent 0 0 ["地址A"]`可以查看交易池中刚刚收到的交易, 通过设置确认数可以查看地址是否入币了









